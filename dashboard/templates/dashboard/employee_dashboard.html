{% extends "base.html" %}
{% block title %}Employee Dashboard{% endblock %}

{% block content %}
<div class="container mt-5">

  <!-- ================= WELCOME HEADER ================= -->
  <div class="mb-5 text-center">
      <h2 class="fw-bold">Welcome, {{ request.user.username }}</h2>
      
  </div>

  {% if profile %}
  <div class="row g-4">

      <!-- ================= PROFILE CARD ================= -->
      <div class="col-md-6">
          <div class="card shadow-sm border-0">
              <div class="card-header bg-light">
                  <h5 class="mb-0">My Profile</h5>
              </div>
              <div class="card-body">
                  <p><strong>Full Name:</strong> {{ profile.full_name }}</p>
                  <p><strong>Email:</strong> {{ request.user.email }}</p>
                  <p><strong>Phone:</strong> {{ profile.phone|default:"Not provided" }}</p>
                  <p><strong>Skills:</strong> {{ profile.skills|default:"Not provided" }}</p>
                  <p><strong>Experience:</strong> {{ profile.experience|default:"Not provided" }}</p>

                  <button type="button" class="btn btn-outline-primary btn-sm mt-2"
                      onclick="document.getElementById('profile-form').classList.toggle('d-none')">
                      Edit Profile
                  </button>

                  <div id="profile-form" class="d-none mt-3">
                      <form method="POST" enctype="multipart/form-data">
                          {% csrf_token %}
                          {{ form.as_p }}
                          <div class="mt-2">
                              <button type="submit" class="btn btn-primary btn-sm">Update</button>
                              <button type="button" class="btn btn-secondary btn-sm"
                                  onclick="document.getElementById('profile-form').classList.add('d-none')">
                                  Cancel
                              </button>
                          </div>
                      </form>
                  </div>
              </div>
          </div>
      </div>

      <!-- ================= RESUME CARD ================= -->
      <div class="col-md-6">
          <div class="card shadow-sm border-0">
              <div class="card-header bg-light">
                  <h5 class="mb-0">My Resume</h5>
              </div>
              <div class="card-body">
                  {% if profile.resume %}
                  <p>
                      <a href="{{ profile.resume.url }}" target="_blank" class="btn btn-outline-primary btn-sm">
                          View / Download Resume
                      </a>
                  </p>
                  {% else %}
                  <p class="text-secondary">No resume uploaded</p>
                  {% endif %}

                  <form method="POST" action="{% url 'accounts:upload_resume' %}" enctype="multipart/form-data" class="mt-3">
                      {% csrf_token %}
                      <div class="input-group">
                          <input type="file" name="resume" accept=".pdf,.doc,.docx" required class="form-control form-control-sm">
                          <button type="submit" class="btn btn-primary btn-sm">Upload</button>
                      </div>
                  </form>
              </div>
          </div>
      </div>

      <!-- ================= MESSAGES CARD ================= -->
      <div class="col-12">
          <div class="card shadow-sm border-0">
              <div class="card-header bg-light">
                  <h5 class="mb-0">Messages from Employers</h5>
              </div>
              <div class="card-body">
                  <ul class="list-group mb-3">
                      {% for msg in messages_received %}
                      <li class="list-group-item d-flex justify-content-between align-items-start {% if not msg.read %} bg-light border-start border-primary {% endif %}">
                          <div>
                              <strong>{{ msg.sender.username }}:</strong> {{ msg.content }}
                              <br>
                              <small class="text-secondary">{{ msg.timestamp|date:"M d, Y H:i" }}</small>
                          </div>
                      </li>
                      {% empty %}
                      <li class="list-group-item text-center text-secondary">No messages yet.</li>
                      {% endfor %}
                  </ul>

                  <form method="post">
                      {% csrf_token %}
                      <div class="mb-2">
                          <textarea name="content" class="form-control form-control-sm" placeholder="Type your message"></textarea>
                      </div>
                      <button type="submit" class="btn btn-primary btn-sm">Send</button>
                  </form>
              </div>
          </div>
      </div>

      <!-- ================= APPLICATIONS CARD ================= -->
      <div class="col-12">
          <div class="card shadow-sm border-0">
              <div class="card-header bg-light">
                  <h5 class="mb-0">My Job Applications</h5>
              </div>
              <div class="card-body">
                  {% if applications %}
                  <div class="table-responsive">
                      <table class="table table-striped table-hover align-middle">
                          <thead class="table-light">
                              <tr>
                                  <th>Job Title</th>
                                  <th>Company</th>
                                  <th>Status</th>
                                  <th>Applied At</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for application in applications %}
                              <tr>
                                  <td>
                                      <a class="text-decoration-none" href="{% url 'jobs:job_detail' application.job.id %}">
                                          {{ application.job.title }}
                                      </a>
                                  </td>
                                  <td>{{ application.job.employer.company_name|default:"N/A" }}</td>
                                  <td>
                                      {{ application.status }}
                                  </td>
                                  <td>{{ application.applied_at|date:"M d, Y H:i" }}</td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                  </div>
                  {% else %}
                      <p class="text-center text-secondary">You haven't applied to any jobs yet.</p>
                  {% endif %}
              </div>
          </div>
      </div>

  </div>

  {% endif %}

  <!-- ================= BROWSE JOBS BUTTON ================= -->
  <div class="text-center mt-5">
      <a href="{% url 'jobs:job_list' %}" class="btn btn-success btn-lg">Browse Jobs</a>
  </div>

</div>
{% endblock %}
